import{e as K,u as N,f as X,g as Z,j as ee,t as ae,r as se,h as S,i as A,k as e,l as le,w as te,s as re,R as F,m as ie,n as oe,p as ue,q as ce,v as ne,x as $,y as I,z as de,A as ve,B as me,C as he,L as ye,D as pe,E as ge,F as Ee,G as M,H as fe,I as B}from"./app-CYJ-jLiX.js";const He=["/intro.html","/","/md/","/md/resume.html","/md/code/","/md/guide/","/md/project/","/md/study/","/md/code/java/","/md/guide/mygit/","/md/project/market/","/md/code/java/juc/dome.html","/md/code/java/juc/","/md/guide/mygit/giteee/dome.html","/md/guide/mygit/giteee/","/md/project/market/bug/","/md/project/market/design/","/md/project/market/log/","/404.html","/category/","/category/%E8%87%AA%E6%88%91%E4%BB%8B%E7%BB%8D/","/category/%E4%B8%93%E4%B8%9A%E6%8A%80%E8%83%BD/","/category/%E9%A1%B9%E7%9B%AE%E7%BB%8F%E9%AA%8C/","/category/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/","/category/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/","/tag/","/article/","/star/","/timeline/"],ke="SLIMSEARCH_QUERY_HISTORY",g=M(ke,[]),Ae=()=>{const{queryHistoryCount:t}=B;return{enabled:t>0,queryHistories:g,addQueryHistory:u=>{g.value=Array.from(new Set([u,...g.value.slice(0,t-1)]))},removeQueryHistory:u=>{g.value=[...g.value.slice(0,u),...g.value.slice(u+1)]}}},q=t=>He[t.id]+("anchor"in t?`#${t.anchor}`:""),Be="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:T}=B,E=M(Be,[]),xe=()=>({enabled:T>0,resultHistories:E,addResultHistory:o=>{{const u={link:q(o),display:o.display};"header"in o&&(u.header=o.header),E.value=[u,...E.value.slice(0,T-1)]}},removeResultHistory:o=>{E.value=[...E.value.slice(0,o),...E.value.slice(o+1)]}}),Re=t=>{const{page:o,routeLocale:u}=de(),x=ve(),r=S(0),f=A(()=>r.value>0),d=me([]);return he(()=>{const{search:R,terminate:h}=ye(),H=ge(y=>{const{resultsFilter:b=l=>l,querySplitter:p,suggestionsFilter:j,...i}=x.value;y?(r.value+=1,R(y,u.value,i).then(l=>b(l,y,u.value,o.value)).then(l=>{r.value-=1,d.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(d.value=[])})):d.value=[]},B.searchDelay-B.suggestDelay,{maxWait:5e3});pe([t,u],([y])=>H(y.join(" "))),Ee(()=>{h()})}),{isSearching:f,results:d}};var we=K({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:o}){const u=N(),x=X(),r=Z(ee),{addQueryHistory:f,queryHistories:d,removeQueryHistory:R}=Ae(),{resultHistories:h,addResultHistory:H,removeResultHistory:y}=xe(),b=ae(t,"queries"),{results:p,isSearching:j}=Re(b),i=se({isQuery:!0,index:0}),l=S(0),v=S(0),D=A(()=>d.value.length>0||h.value.length>0),w=A(()=>p.value.length>0),Q=A(()=>p.value[l.value]||null),U=()=>{const{isQuery:a,index:s}=i;s===0?(i.isQuery=!a,i.index=a?h.value.length-1:d.value.length-1):i.index=s-1},_=()=>{const{isQuery:a,index:s}=i;s===(a?d.value.length-1:h.value.length-1)?(i.isQuery=!a,i.index=0):i.index=s+1},O=()=>{l.value=l.value>0?l.value-1:p.value.length-1,v.value=Q.value.contents.length-1},P=()=>{l.value=l.value<p.value.length-1?l.value+1:0,v.value=0},Y=()=>{v.value<Q.value.contents.length-1?v.value+=1:P()},z=()=>{v.value>0?v.value-=1:O()},C=a=>a.map(s=>fe(s)?s:e(s[0],s[1])),G=a=>{if(a.type==="customField"){const s=ce[a.index]||"$content",[m,c=""]=ne(s)?s[x.value].split("$content"):s.split("$content");return a.display.map(n=>e("div",C([m,...n,c])))}return a.display.map(s=>e("div",C(s)))},k=()=>{l.value=0,v.value=0,o("updateQuery",""),o("close")},V=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,s)=>{const m=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{o("updateQuery",a)}},e("div",[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),R(s)}})]))}))])),W=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((a,s)=>{const m=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(F,{to:a.link,onClick:()=>{k()}},()=>[e($,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(c=>C(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:I,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(s)}})]))}))]));return le("keydown",a=>{if(t.isFocusing){if(w.value){if(a.key==="ArrowUp")z();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const s=Q.value.contents[v.value];f(t.queries.join(" ")),H(s),u.push(q(s)),k()}}else if(a.key==="ArrowUp")U();else if(a.key==="ArrowDown")_();else if(a.key==="Enter"){const{index:s}=i;i.isQuery?(a.preventDefault(),o("updateQuery",d.value[s])):(u.push(h.value[s].link),k())}}}),te([l,v],()=>{var a;(a=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||a.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!w.value:!D.value}]},t.queries.length?j.value?e(re,{hint:r.value.searching}):w.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:a,contents:s},m)=>{const c=l.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,J)=>{const L=c&&v.value===J;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e(F,{to:q(n),onClick:()=>{f(t.queries.join(" ")),H(n),k()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ue,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:D.value?[V(),W()]:r.value.emptyHistory)}});export{we as default};
